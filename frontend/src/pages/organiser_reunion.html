<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>organiser reunion</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../css/dashboard_r.css">

    <style>
        body {
         font-family: Arial, sans-serif;
         background: #E6E6FA;
         margin: 0;
         padding: 20px;
         display: flex;
         justify-content: flex-start;
         align-items: center;
         min-height: 100vh;
       }
   
     .form-container {
       background-color: white;
       border-radius: 8px;
       box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
       padding: 30px;
       width: 100%;
       max-width: 500px;
       margin-left: 500px;
     }
   
     h1 {
       font-size: 24px;
       margin-top: 0;
       margin-bottom: 25px;
       color: #333;
       text-align: center;
     }
   
     .form-group {
       margin-bottom: 20px;
     }
   
     label {
       display: block;
       margin-bottom: 8px;
       font-weight: bold;
       color: #555;
     }
   
     input[type="text"],
     input[type="date"],
     input[type="file"],
     textarea,
     select {
       width: 100%;
       padding: 10px;
       border: 1px solid #ddd;
       border-radius: 20px;
       font-size: 16px;
       box-sizing: border-box;
     }
   
     textarea {
       min-height: 100px;
       resize: vertical;
     }
   
     .button-group {
       display: flex;
       justify-content: flex-end;
       gap: 10px;
       margin-top: 30px;
     }
   
     button {
       padding: 10px 20px;
       border: none;
       border-radius: 10px;
       font-size: 16px;
       cursor: pointer;
       transition: background-color 0.3s;
     }
   
     .cancel-btn {
       background-color: #f0f0f0;
       color: #333;
     }
   
     .cancel-btn:hover {
       transform: scale(1.02);
       background-color: #e0e0e0;
     }
   
     .submit-btn {
       background-color: #8F00FF;
       color: white;
     }
   
     .submit-btn:hover {
       background-color: #6F00FF;
       transform: scale(1.02);
     }
   
     .custom-file-upload {
       display: flex;
       align-items: center;
       gap: 10px;
       flex-wrap: wrap;
     }
   
     .upload-btn {
       background-color: #8F00FF;
       color: white;
       padding: 8px 16px;
       border: none;
       border-radius: 20px;
       cursor: pointer;
       font-size: 14px;
       transition: background-color 0.3s;
     }
   
     .upload-btn:hover {
       background-color: #6F00FF;
       transform: scale(1.02);
     }
   
     #file-name {
       font-size: 14px;
       color: #666;
       max-width: 250px;
       white-space: nowrap;
       overflow: hidden;
       text-overflow: ellipsis;
     }
   </style>
</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar">
      <h2 class="titre">Gestion projet</h2>
      <nav>
          <ul>
              <li>
                  <a href="dashboard_r.html">
                      <i class="fas fa-tachometer-alt"></i>  Dashboard
                  </a>
              </li>
              <li>
                  <a href="consulter_binome_r.html" >
                      <i class="fas fa-users"></i>  Voir Binomes
                  </a>
              </li>
              <li>
                <a href="decrire_sujet.html">
                    <i class="fas fa-file-alt"></i> Décrire Sujet
                </a>
            </li>
  
              <li>
                  <a href="preciser_sujet.html">
                      <i class="fas fa-tasks"></i> Gestion Etape
                  </a>
              </li>
              <li >
                <a href="preciser_cas.html">
                    <i class="fas fa-tasks"></i> Preciser cas
                </a>
            </li>
              <li class="active"  >
                  <a href="organiser_reunion.html">
                      <i class="fas fa-calendar-check"></i> Organiser Reunion
                  </a>
              </li>
              <li  >
                  <a href="consulter_rap_ens_res.html">
                      <i class="fas fa-eye"></i> Voir Rapport
                  </a>
              </li>
              <li ><a href="consulter_question.html"><i class="fas fa-comments"></i> Voir Question</a></li>

  
              <li >
                  <a href="voir_profil_r.html">
                      <i class="fas fa-user"></i> Voir profil
                  </a>
              </li>
          </ul>
      </nav>
  </aside>



    <div class="form-container">
        <h1>Organiser une Réunion</h1>

        <form id="reunionForm">
        <div class="mb-3">
                <label for="lieuReunion" class="form-label">titre</label>
                <input type="text" class="form-control" id="titreReunion" name="titreReunion"  required>
            </div>
    
           <div class="mb-3">
    <label for="dateReunion" class="form-label">Date et heure de la réunion</label>
    <input type="datetime-local" class="form-control" id="dateReunion" name="dateReunion" required>
</div>

             <label for="groupeReunion" class="form-label">Groupe</label>

            <select id="groupeens-select" class="form-select mb-3">
            <option value="">Sélectionner un groupe</option>
            <!-- Options chargées dynamiquement -->
             </select>
           
    
            <div class="mb-3">
                <label for="lieuReunion" class="form-label">Lien</label>
                <input type="text" class="form-control" id="lieuReunion" name="lieuReunion"  required>
            </div>
    
            <div class="mb-3">
                <label for="sujetReunion" class="form-label"> remarque</label>
                <textarea class="form-control" id="sujetReunion" name="sujetReunion" rows="4" placeholder="Ex: Avancement du projet, répartition des tâches..." required></textarea>
            </div>
    
            <div class="button-group">
                <button type="button" class="cancel-btn" id="cancelBtn">Annuler</button>
                <button type="submit" class="submit-btn">Organiser</button>
            </div>
        </form>
    </div>
    
       <script src="../js/simulate_login.js"></script>

      <script>
        document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('reunionForm');
    const cancelBtn = document.getElementById('cancelBtn');
    // Correction: Utiliser le bon ID qui correspond à votre HTML
    const groupeSelect = document.getElementById('groupeens-select'); // Changé de 'groupeReunion' à 'groupeens-select'
    const responsableId = localStorage.getItem('idResponsable');
    
    // Charger les groupes
    async function chargerGroupes() {
        try {
            const response = await fetch(`http://localhost:3000/api/groupes/groupes-par-enseignant/${responsableId}`);
            if (!response.ok) throw new Error('Erreur réseau');
            
            const groupes = await response.json();
            // Vérifier que l'élément existe avant de modifier son innerHTML
            if (groupeSelect) {
                groupeSelect.innerHTML = '<option value="">Sélectionner un groupe</option>';
                
                groupes.forEach(groupe => {
                    const option = document.createElement('option');
                    option.value = groupe.idG;
                    option.textContent = groupe.nom;
                    groupeSelect.appendChild(option);
                });
            } else {
                console.error("L'élément select des groupes n'a pas été trouvé");
            }
        } catch (error) {
            console.error('Erreur:', error);
            if (groupeSelect) {
                groupeSelect.innerHTML = '<option value="">Erreur de chargement</option>';
            }
        }
    }
    
    // Soumission du formulaire
   form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const titre = document.getElementById('titreReunion').value;
    const dateInput = document.getElementById('dateReunion').value; // Format: "YYYY-MM-DDTHH:MM"
    const lien = document.getElementById('lieuReunion').value;
    const remarque = document.getElementById('sujetReunion').value;
    const groupeId = document.getElementById('groupeens-select').value;
    const responsableId = localStorage.getItem('idResponsable');
    
    // Convertir le datetime-local en format MySQL (YYYY-MM-DD HH:MM:SS)
    const dateReunion = new Date(dateInput).toISOString().slice(0, 19).replace('T', ' ');
    
    if (!groupeId) {
        alert('Veuillez sélectionner un groupe');
        return;
    }
    
    try {
        const response = await fetch('http://localhost:3000/api/creer-reunion', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                titre,
                dateReunion, // Format compatible MySQL datetime
                lieuReunion: lien,
                remarqueReunion: remarque,
                groupe: groupeId,
                enseignantRId: responsableId
            })
        });

        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.message || `Erreur HTTP: ${response.status}`);
        }
        
        alert('Réunion créée avec succès! ID: ' + data.reunionId);
        form.reset();
    } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur: ' + error.message);
    }
});
    
    // Bouton Annuler
    cancelBtn.addEventListener('click', function() {
        if (confirm('Annuler la création de la réunion?')) {
            form.reset();
        }
    });
    
    // Initialisation
    chargerGroupes();
});
    </script>
</body>
</html>
