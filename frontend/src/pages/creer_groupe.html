<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er Groupe</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../css/creer_groupe.css">
    
</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <h2 class="titre">Gestion projet</h2>
        <nav>
            <ul>
                <li>
                    <a href="dashboard.html">
                        <i class="fas fa-tachometer-alt"></i>  Dashboard
                    </a>
                </li>
                <li class="active">
                    <a href="creer_groupe.html" id="menu-creer-groupes">
                        <i class="fas fa-users"></i>  Cr√©er groupes
                    </a>
                </li>
                <li>
                    <a href="voir_groupe.html">
                        <i class="fas fa-eye"></i>  Voir groupe
                    </a>
                </li>
                <li >
                    <a href="voir_profil.html">
                        <i class="fas fa-user"></i> Voir profil
                    </a>
                </li>
            </ul>
        </nav>
    </aside>
    

    <main>
        <h1 >Liste des bin√¥mes</h1>
        <div class="table-responsive">
        <!-- Tableau des bin√¥mes -->
        <table class="table table-bordered">
            <thead class="table-primary">
                <tr>
                    <th>Num√©ro</th>
                    <th>Matricule</th>
                    <th>Nom</th>
                    <th>Pr√©nom</th>
                </tr>
            </thead>
            <tbody id="table-binomes">
                <!-- Les bin√¥mes seront affich√©s ici dynamiquement -->
            </tbody>
        </table>
    </div>

        <!-- Bouton pour ouvrir la fen√™tre modale -->
        <button id="btn-creer-groupe" class="btn btn-success mt-3" data-bs-toggle="modal" data-bs-target="#modalGroupe">
            Cr√©er Groupe
        </button>
        <!-- Bouton pour ouvrir la fen√™tre modale d'ajout de bin√¥me -->
<button id="btn-ajouter-binome" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#modalAjouterBinome">
    Ajouter Bin√¥me
</button>

    </main>

      <!-- Fen√™tre modale pour la cr√©ation de groupe -->
      <div class="modal fade" id="modalGroupe" tabindex="-1" aria-labelledby="modalGroupeLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalGroupeLabel">Cr√©er un Groupe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="form-groupe">
                        <div class="mb-3">
                            <label for="binome_id" class="form-label">Choisir un bin√¥me</label>
                            <select class="form-control" id="binome_id" required>
                                <!-- Les bin√¥mes seront ajout√©s ici dynamiquement, mais sans option par d√©faut -->
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="groupe_nom" class="form-label">Choisir un Groupe</label>
                            <select class="form-control" id="groupe_nom" required>
                                <!-- Les noms des groupes existants seront ajout√©s ici dynamiquement -->
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100" id="creer">Cr√©er</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

<!-- Fen√™tre modale pour ajouter un bin√¥me -->
<div class="modal fade" id="modalAjouterBinome" tabindex="-1" aria-labelledby="modalAjouterBinomeLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalAjouterBinomeLabel">Ajouter un Bin√¥me</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form-ajouter-binome">
                    <div class="mb-3">
                        <label for="matricule1" class="form-label">Matricule √âtudiant 1</label>
                        <input type="text" class="form-control" id="matricule1" required>
                    </div>
                    <div class="mb-3">
                        <label for="matricule2" class="form-label">Matricule √âtudiant 2</label>
                        <input type="text" class="form-control" id="matricule2" required>
                    </div>
                    <button type="button" class="btn btn-primary" id="btn-ajouter-binome-modal">Ajouter Bin√¥me</button>
                </form>
            </div>
        </div>
    </div>
</div>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>

document.addEventListener("DOMContentLoaded", function() {
    const menuItems = document.querySelectorAll('.sidebar nav ul li');

    // Parcourir tous les √©l√©ments du menu et ajouter un √©v√©nement de clic
    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            // Supprimer la classe active de tous les √©l√©ments du menu
            menuItems.forEach(li => li.classList.remove('active'));
            
            // Ajouter la classe active √† l'√©l√©ment actuellement cliqu√©
            this.classList.add('active');
        });
    });
});



document.addEventListener("DOMContentLoaded", function () {
    const tableBody = document.getElementById("table-binomes");
    const selectBinome = document.getElementById("binome_id");

    if (!tableBody || !selectBinome) {
        console.error("‚ùå √âl√©ment introuvable !");
        return;
    }

    // Charger les bin√¥mes
    fetch("http://localhost:3000/binomes")
    .then(response => response.json())
    .then(binomes => {
        console.log("üìå Donn√©es re√ßues :", binomes); // D√©bogage
        tableBody.innerHTML = "";
        selectBinome.innerHTML = '';

        binomes.forEach(binome => {
            console.log("‚û° Bin√¥me :", binome); // Debugging

            if (!binome.binome_id) {
                console.warn("‚ö†Ô∏è Avertissement : ID bin√¥me manquant !");
                return;
            }

            // Premi√®re ligne pour le premier √©tudiant du bin√¥me
            const row1 = document.createElement("tr");
            row1.innerHTML = `
                <td rowspan="${binome.etudiant2_nom ? 2 : 1}">${binome.binome_id}</td>
                <td>${binome.etudiant1_matricule || "N/A"}</td>
                <td>${binome.etudiant1_nom || "Inconnu"}</td>
                <td>${binome.etudiant1_prenom || ""}</td>
            `;
            tableBody.appendChild(row1);

            // Si le bin√¥me a un deuxi√®me √©tudiant, on ajoute une seconde ligne
            if (binome.etudiant2_nom) {
                const row2 = document.createElement("tr");
                row2.innerHTML = `
                    <td>${binome.etudiant2_matricule || "N/A"}</td>
                    <td>${binome.etudiant2_nom || "Inconnu"}</td>
                    <td>${binome.etudiant2_prenom || ""}</td>
                `;
                tableBody.appendChild(row2);
            }

            // Ajouter le bin√¥me dans la liste d√©roulante
            const option = document.createElement("option");
            option.value = binome.binome_id;
            option.textContent = `Bin√¥me ${binome.binome_id}`;
            selectBinome.appendChild(option);
        });
    })
    .catch(error => console.error("‚ùå Erreur lors du chargement des bin√¥mes:", error));
});





    // Charger les groupes
    fetch("http://localhost:3000/groupes")
    .then(response => response.json())
    .then(groupes => {
        console.log(groupes);  // V√©rifier ce que vous obtenez ici
        selectGroupe.innerHTML = '';
        groupes.forEach(groupe => {
            const option = document.createElement("option");
            option.value = groupe.nom_groupe; // Assurez-vous que vous utilisez le bon nom de propri√©t√©
            option.textContent = groupe.nom_groupe; // Afficher le nom du groupe
            selectGroupe.appendChild(option);
        });
    })
    .catch(error => console.error("‚ùå Erreur lors du chargement des groupes:", error));


    document.addEventListener("DOMContentLoaded", function () {
    const formGroupe = document.getElementById("form-groupe");

    if (!formGroupe) {
        console.error("‚ùå Formulaire introuvable !");
        return;
    }

    formGroupe.addEventListener("submit", function (event) {
        event.preventDefault(); // Emp√™cher le rechargement de la page

        const binomeId = document.getElementById("binome_id").value;
        const groupeNom = document.getElementById("groupe_nom").value;

        if (!binomeId || !groupeNom) {
            console.error("‚ùå Veuillez remplir tous les champs !");
            return;
        }

        // Envoyer la requ√™te POST pour l'association du bin√¥me avec le groupe
        fetch("http://localhost:3000/associerBinomeGroupe", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                binome_id: binomeId,
                groupe_nom: groupeNom
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Bin√¥me associ√© au groupe avec succ√®s !");
                // Vous pouvez fermer la modale ici, si vous le souhaitez
                const modal = new bootstrap.Modal(document.getElementById('modalGroupe'));
                modal.hide();
            } else {
                alert("‚ùå Erreur lors de l'association !");
            }
        })
        .catch(error => console.error("‚ùå Erreur de connexion avec le serveur :", error));
    });
});


document.addEventListener("DOMContentLoaded", function () {
    const btnAjouterBinomeModal = document.getElementById("btn-ajouter-binome-modal");

    if (btnAjouterBinomeModal) {
        btnAjouterBinomeModal.addEventListener("click", function() {
            const matricule1 = document.getElementById("matricule1").value;
            const matricule2 = document.getElementById("matricule2").value;

            // V√©rification des champs
            if (!matricule1) {
                alert("Veuillez remplir le matricule de l'√©tudiant 1 !");
                return;
            }

            // Si matricule2 est vide, on le consid√®re comme null (√©tudiant seul)
            const etudiant2 = matricule2.trim() ? matricule2 : null;

            // Envoi de la requ√™te pour ajouter le bin√¥me (ou l'√©tudiant seul)
            fetch("http://localhost:3000/ajouter-binome", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    matricule1: matricule1,
                    matricule2: etudiant2  // Si vide, il sera envoy√© comme null
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Bin√¥me ajout√© avec succ√®s !");
                    // Fermer la modale
                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalAjouterBinome'));
                    modal.hide();
                } else {
                    alert("Erreur lors de l'ajout du bin√¥me !");
                }
            })
            .catch(error => console.error("Erreur de connexion :", error));
        });
    }
});




    </script>
       <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="../js/creer_groupe.js"></script>
</body>
</html>